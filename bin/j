#!/usr/bin/env bash

echo [Unit] > echo-test
echo Description=\"IBM SP Client dsmcad_C_DCI_UNIX_SUDO service.\" >> echo-test
echo After=local-fs.target network-online.target >> echo-test
echo >> echo-test
echo [Service] >> echo-test
echo Type=forking >> echo-test
echo GuessMainPID=no >> echo-test
echo Environment=\"DSM_CONFIG=/opt/tivoli/tsm/client/ba/bin/dsm_C_DCI_UNIX_SUDO.opt\" >> echo-test
echo Environment=\"JAVA_HOME=/opt/tivoli/tsm/tdpvmware/common/jre/jre\" >> echo-test
echo Environment=\"LD_LIBRARY_PATH=/opt/tivoli/tsm/client/ba/bin:/opt/tivoli/tsm/tdpvmware/common/jre/jre/bin/classic\" >> echo-test
echo Environment=\"PATH=/opt/tivoli/tsm/tdpvmware/common/jre/jre/bin:/sbin:/usr/sbin:/usr/local/sbin:/root/bin:/usr/local/bin:/usr/bin:/bin\" >> echo-test
echo Environment=\"LANG=en_US\" >> echo-test
echo Environment=\"LC_ALL=en_US\" >> echo-test
echo ExecStart=/usr/bin/dsmcad -optfile=/opt/tivoli/tsm/client/ba/bin/dsm_C_DCI_UNIX_SUDO.opt >> echo-test
echo ExecStopPost=/bin/bash -c \''SEARCH="/usr/bin/dsmcad -optfile=/opt/tivoli/tsm/client/ba/bin/dsm_C_DCI_UNIX_SUDO.opt"; CHECK=$(ps -eo args | grep -- "${SEARCH}" | grep -v grep); let i=0; while [[ -n "${CHECK}" && ($i -lt 10) ]]; do let i++; echo $i; sleep 1; CHECK=$(ps -eo args | grep -- "$SEARCH" | grep -v grep); done'\' >> echo-test
echo Restart=on-failure >> echo-test
echo >> echo-test
echo [Install] >> echo-test
echo WantedBy=multi-user.target >> echo-test

